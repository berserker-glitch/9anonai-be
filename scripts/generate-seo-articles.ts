/**
 * SEO-Targeted Multilingual Blog Generator
 * 
 * Forked from generate-articles.ts â€” specifically targets SEO keywords that 
 * 9anonai.com needs to rank for on Google. Generates blog articles in 3 languages
 * (AR, EN, FR) focused on the high-intent and long-tail keywords.
 * 
 * IMPORTANT: This does NOT modify generate-articles.ts â€” that script is still
 * used for general blog generation.
 * 
 * @module scripts/generate-seo-articles
 * @requires OPENROUTER_API_KEY set in environment
 */

import dotenv from "dotenv";
dotenv.config();

import OpenAI from "openai";
import * as fs from "fs";
import * as path from "path";
import { getTable } from "../src/services/db";
import { getEmbedding } from "../src/services/bi";

// Configure OpenAI client with OpenRouter
const client = new OpenAI({
    baseURL: "https://openrouter.ai/api/v1",
    apiKey: process.env.OPENROUTER_API_KEY,
    defaultHeaders: {
        "HTTP-Referer": "https://github.com/moroccan-legal-ai",
        "X-Title": "9anon - SEO Blog Generator",
    },
});

/**
 * SEO-targeted blog topics â€” each one maps to specific keywords the site
 * needs to rank for. These are NOT randomly generated by LLM; they are
 * strategically chosen to match the user's target keyword list.
 */
const SEO_TOPICS = [
    {
        slug: "legal-ai-assistant-morocco-guide",
        titles: {
            ar: "Ù…Ø³Ø§Ø¹Ø¯ Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø°ÙƒÙŠ ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨: Ø¯Ù„ÙŠÙ„Ùƒ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
            en: "Legal AI Assistant in Morocco: Your Complete Guide to AI-Powered Legal Help",
            fr: "Assistant Juridique IA au Maroc : Guide Complet de l'Aide Juridique par Intelligence Artificielle",
        },
        descriptions: {
            ar: "ØªØ¹Ø±Ù Ø¹Ù„Ù‰ ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯ Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø°ÙƒÙŠ ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ´Ø§Ø±Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ÙÙˆØ±ÙŠØ© ÙˆÙ…Ø¬Ø§Ù†ÙŠØ©",
            en: "Learn how AI legal assistants work in Morocco and how you can get free, instant legal advice online",
            fr: "DÃ©couvrez comment les assistants juridiques IA fonctionnent au Maroc et obtenez des conseils juridiques gratuits",
        },
        searchQuery: "Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ù…Ø³Ø§Ø¹Ø¯ Ù‚Ø§Ù†ÙˆÙ†ÙŠ",
        keywords: ["legal AI assistant Morocco", "AI lawyer Morocco", "assistant juridique IA Maroc", "Ù…Ø³Ø§Ø¹Ø¯ Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø°ÙƒÙŠ Ø§Ù„Ù…ØºØ±Ø¨", "online legal advice Morocco", "conseil juridique en ligne Maroc"],
    },
    {
        slug: "divorce-procedure-morocco-complete-guide",
        titles: {
            ar: "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø·Ù„Ø§Ù‚ ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨: Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ø­Ù‚ÙˆÙ‚Ùƒ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©",
            en: "Divorce Procedure in Morocco: Complete Legal Guide to Your Rights",
            fr: "ProcÃ©dure de Divorce au Maroc : Guide Juridique Complet de Vos Droits",
        },
        descriptions: {
            ar: "ÙƒÙ„ Ù…Ø§ ØªØ­ØªØ§Ø¬ Ù…Ø¹Ø±ÙØªÙ‡ Ø¹Ù† Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø·Ù„Ø§Ù‚ ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ ÙˆØ­Ù‚ÙˆÙ‚Ùƒ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø­Ø³Ø¨ Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø£Ø³Ø±Ø©",
            en: "Everything you need to know about divorce proceedings in Morocco and your legal rights under the Moudawana",
            fr: "Tout ce que vous devez savoir sur la procÃ©dure de divorce au Maroc et vos droits selon la Moudawana",
        },
        searchQuery: "Ø§Ù„Ø·Ù„Ø§Ù‚ ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø£Ø³Ø±Ø©",
        keywords: ["divorce lawyer Morocco online", "divorce Maroc procÃ©dure", "Ø§Ù„Ø·Ù„Ø§Ù‚ ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª", "inheritance law Morocco help", "droit successoral Maroc"],
    },
    {
        slug: "employee-rights-morocco-labor-law",
        titles: {
            ar: "Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨: Ù…Ø§Ø°Ø§ ÙŠÙ‚ÙˆÙ„ Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø´ØºÙ„ Ø¹Ù† Ø­Ù…Ø§ÙŠØªÙƒ",
            en: "Employee Rights in Morocco: What the Labor Code Says About Your Protection",
            fr: "Droits des EmployÃ©s au Maroc : Ce Que le Code du Travail Dit de Votre Protection",
        },
        descriptions: {
            ar: "Ø§ÙƒØªØ´Ù Ø­Ù‚ÙˆÙ‚Ùƒ ÙƒÙ…ÙˆØ¸Ù ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ø­Ø³Ø¨ Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø´ØºÙ„: Ø§Ù„Ø¹Ù‚Ø¯ØŒ Ø§Ù„Ø£Ø¬Ø±ØŒ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§ØªØŒ Ø§Ù„ÙØµÙ„ Ø§Ù„ØªØ¹Ø³ÙÙŠ",
            en: "Discover your rights as an employee in Morocco under the Labor Code: contracts, wages, leave, wrongful dismissal",
            fr: "DÃ©couvrez vos droits en tant qu'employÃ© au Maroc selon le Code du Travail : contrats, salaires, congÃ©s, licenciement",
        },
        searchQuery: "Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…ØºØ±Ø¨ Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø´ØºÙ„ Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø´ØºÙ„",
        keywords: ["employee rights Morocco", "labor law advice Morocco", "droits des employÃ©s Maroc", "Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨", "droit du travail Maroc conseil", "Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø´ØºÙ„ Ø§Ù„Ù…ØºØ±Ø¨ Ø§Ø³ØªØ´Ø§Ø±Ø©"],
    },
    {
        slug: "tenant-rights-morocco-rental-disputes",
        titles: {
            ar: "Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨: ÙƒÙŠÙ ØªØ­Ù…ÙŠ Ù†ÙØ³Ùƒ Ù…Ù† Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©",
            en: "Tenant Rights in Morocco: How to Protect Yourself from Rental Disputes",
            fr: "Droits du Locataire au Maroc : Comment Vous ProtÃ©ger des Litiges Locatifs",
        },
        descriptions: {
            ar: "Ø¯Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ ÙˆÙƒÙŠÙÙŠØ© ØªÙ‚Ø¯ÙŠÙ… Ø´ÙƒÙˆÙ‰ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±ÙŠØ©",
            en: "Comprehensive guide to tenant rights in Morocco and how to file complaints for rental disputes",
            fr: "Guide complet des droits du locataire au Maroc et comment dÃ©poser une plainte en cas de litige locatif",
        },
        searchQuery: "Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ø§Ù„Ù…ØºØ±Ø¨ Ù†Ø²Ø§Ø¹ Ø§ÙŠØ¬Ø§Ø±ÙŠ",
        keywords: ["tenant rights Morocco", "how to file complaint in Morocco", "litige locatif Maroc", "Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨"],
    },
    {
        slug: "starting-business-morocco-company-registration",
        titles: {
            ar: "ØªØ³Ø¬ÙŠÙ„ Ø´Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨: Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯",
            en: "Starting a Business in Morocco: Legal Guide to Company Registration",
            fr: "CrÃ©er une SociÃ©tÃ© au Maroc : Guide Juridique pour l'Enregistrement d'Entreprise",
        },
        descriptions: {
            ar: "Ø®Ø·ÙˆØ§Øª ØªØ³Ø¬ÙŠÙ„ Ø´Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ù…Ø¹ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©. ÙƒÙ„ Ù…Ø§ ÙŠØ­ØªØ§Ø¬Ù‡ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
            en: "Step-by-step legal guide to registering a company in Morocco. Everything new entrepreneurs need",
            fr: "Guide juridique Ã©tape par Ã©tape pour crÃ©er une sociÃ©tÃ© au Maroc. Tout pour les nouveaux entrepreneurs",
        },
        searchQuery: "ØªØ³Ø¬ÙŠÙ„ Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØºØ±Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø§ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠ",
        keywords: ["company registration legal help Morocco", "startup legal advice Morocco", "crÃ©ation sociÃ©tÃ© Maroc assistance juridique", "conseil juridique startup Maroc", "ØªØ³Ø¬ÙŠÙ„ Ø´Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø©", "legal support for startups Morocco"],
    },
    {
        slug: "contract-review-ai-morocco-business",
        titles: {
            ar: "ØµÙŠØ§ØºØ© ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
            en: "AI Contract Review in Morocco: Smarter Business Contract Management",
            fr: "RÃ©vision de Contrats par IA au Maroc : Gestion Intelligente des Contrats d'Affaires",
        },
        descriptions: {
            ar: "ÙƒÙŠÙ ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ ØµÙŠØ§ØºØ© ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…ØºØ±Ø¨ÙŠ",
            en: "How AI helps you draft and review business contracts under Moroccan law",
            fr: "Comment l'IA vous aide Ã  rÃ©diger et rÃ©viser les contrats d'affaires selon le droit marocain",
        },
        searchQuery: "ØµÙŠØ§ØºØ© Ø¹Ù‚Ø¯ Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØºØ±Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ù‚ÙˆØ¯",
        keywords: ["contract review AI Morocco", "business contract review Morocco", "rÃ©daction contrat Maroc", "ØµÙŠØ§ØºØ© Ø¹Ù‚Ø¯ Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØºØ±Ø¨"],
    },
    {
        slug: "commercial-law-morocco-business-compliance",
        titles: {
            ar: "Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠ Ø§Ù„Ù…ØºØ±Ø¨ÙŠ: Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù„Ù„Ø´Ø±ÙƒØ§Øª",
            en: "Moroccan Commercial Law: Business Compliance Guide for Companies",
            fr: "Droit Commercial Marocain : Guide de ConformitÃ© Juridique pour les Entreprises",
        },
        descriptions: {
            ar: "ÙƒÙ„ Ù…Ø§ ØªØ­ØªØ§Ø¬ Ù…Ø¹Ø±ÙØªÙ‡ Ø¹Ù† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠ Ø§Ù„Ù…ØºØ±Ø¨ÙŠ ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù„Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„Ù…ØªÙˆØ³Ø·Ø©",
            en: "Everything you need to know about Moroccan commercial law and legal compliance for SMEs",
            fr: "Tout sur le droit commercial marocain et la conformitÃ© juridique pour les PME",
        },
        searchQuery: "Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠ Ø§Ù„Ù…ØºØ±Ø¨ÙŠ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„Ø´Ø±ÙƒØ§Øª",
        keywords: ["Moroccan commercial law advice", "corporate legal compliance Morocco", "droit commercial Maroc conseil", "conformitÃ© lÃ©gale entreprise Maroc", "Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„ØªØ¬Ø§Ø±ÙŠ Ø§Ù„Ù…ØºØ±Ø¨ÙŠ", "Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù„Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…ØºØ±Ø¨", "SME legal services Morocco"],
    },
    {
        slug: "inheritance-law-morocco-succession-rights",
        titles: {
            ar: "Ø§Ù„Ø¥Ø±Ø« ÙÙŠ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…ØºØ±Ø¨ÙŠ: Ø­Ù‚ÙˆÙ‚Ùƒ ÙÙŠ Ø§Ù„Ù…ÙŠØ±Ø§Ø« ÙˆØ§Ù„ØªØ±ÙƒØ©",
            en: "Inheritance Law in Morocco: Your Rights to Succession and Estate",
            fr: "Droit Successoral au Maroc : Vos Droits en MatiÃ¨re d'HÃ©ritage et de Succession",
        },
        descriptions: {
            ar: "Ø¯Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¥Ø±Ø« ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ ÙˆØ­Ù‚ÙˆÙ‚ Ø§Ù„ÙˆØ±Ø«Ø© Ø­Ø³Ø¨ Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø£Ø³Ø±Ø© ÙˆØ§Ù„Ø´Ø±ÙŠØ¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©",
            en: "Comprehensive guide to inheritance law in Morocco and heirs' rights under the Moudawana",
            fr: "Guide complet du droit successoral au Maroc et des droits des hÃ©ritiers selon la Moudawana",
        },
        searchQuery: "Ø§Ù„Ø¥Ø±Ø« ÙÙŠ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…ØºØ±Ø¨ÙŠ Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…ÙŠØ±Ø§Ø«",
        keywords: ["inheritance law Morocco help", "droit successoral Maroc", "Ø§Ù„Ø¥Ø±Ø« ÙÙŠ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…ØºØ±Ø¨ÙŠ"],
    },
    {
        slug: "tax-compliance-morocco-business-guide",
        titles: {
            ar: "Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø´Ø±ÙƒØ§Øª ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨: Ø¯Ù„ÙŠÙ„ Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø´Ø§Ù…Ù„",
            en: "Tax Compliance for Businesses in Morocco: Comprehensive Legal Guide",
            fr: "ConformitÃ© Fiscale des Entreprises au Maroc : Guide Juridique Complet",
        },
        descriptions: {
            ar: "ÙƒÙ„ Ù…Ø§ ÙŠØ­ØªØ§Ø¬Ù‡ Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ø¹Ù† Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©",
            en: "Everything business owners in Morocco need to know about tax compliance and legal obligations",
            fr: "Tout ce que les entrepreneurs au Maroc doivent savoir sur la conformitÃ© fiscale et les obligations lÃ©gales",
        },
        searchQuery: "Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…ØºØ±Ø¨ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨",
        keywords: ["tax compliance legal help Morocco", "SME legal services Morocco", "conformitÃ© lÃ©gale entreprise Maroc", "aide juridique entreprise Maroc"],
    },
    {
        slug: "online-legal-consultation-morocco-chatbot",
        titles: {
            ar: "Ø§Ø³ØªØ´Ø§Ø±Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§ÙˆÙ†Ù„Ø§ÙŠÙ† ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨: ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ",
            en: "Online Legal Consultation in Morocco: How Legal Chatbots Work",
            fr: "Consultation Juridique en Ligne au Maroc : Comment Fonctionnent les Chatbots Juridiques",
        },
        descriptions: {
            ar: "ØªØ¹Ø±Ù Ø¹Ù„Ù‰ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ´Ø§Ø±Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…Ø¬Ø§Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ù…ØºØ±Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
            en: "Learn how to get free online legal consultation in Morocco through AI-powered legal chatbots",
            fr: "DÃ©couvrez comment obtenir une consultation juridique gratuite en ligne au Maroc via les chatbots IA",
        },
        searchQuery: "Ø§Ø³ØªØ´Ø§Ø±Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§ÙˆÙ†Ù„Ø§ÙŠÙ† Ø§Ù„Ù…ØºØ±Ø¨ Ø´Ø§Øª Ø¨ÙˆØª Ù‚Ø§Ù†ÙˆÙ†ÙŠ",
        keywords: ["legal chatbot Morocco", "online legal advice Morocco", "chatbot juridique Maroc", "consultation juridique digitale Maroc", "Ø´Ø§Øª Ø¨ÙˆØª Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„Ù…ØºØ±Ø¨", "Ø§Ø³ØªØ´Ø§Ø±Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§ÙˆÙ†Ù„Ø§ÙŠÙ† Ø§Ù„Ù…ØºØ±Ø¨", "Moroccan legal consultation online"],
    },
];

/**
 * Language configuration for article generation
 */
const LANGUAGES = [
    { code: "ar", name: "Arabic", suffix: "", direction: "rtl" },
    { code: "en", name: "English", suffix: ".en", direction: "ltr" },
    { code: "fr", name: "French", suffix: ".fr", direction: "ltr" },
];

/**
 * @description Generated blog article shape
 */
interface GeneratedBlog {
    slug: string;
    language: string;
    title: string;
    description: string;
    content: string;
    sources: string[];
    generatedAt: Date;
}

/**
 * @description Blog topic shape with translations
 */
interface BlogTopic {
    slug: string;
    titles: { ar: string; en: string; fr: string };
    descriptions: { ar: string; en: string; fr: string };
    searchQuery: string;
    keywords: string[];
}

/**
 * Search legal documents using the RAG system
 * @param {string} query - Search query in Arabic
 * @param {number} limit - Max results
 * @returns Array of legal doc results
 */
async function searchLegalDocs(query: string, limit: number = 5): Promise<any[]> {
    try {
        const table = await getTable();
        if (!table) {
            console.warn("   âš ï¸  RAG table not found, proceeding without context.");
            return [];
        }
        const queryEmbedding = await getEmbedding(query);
        const results = await table.search(queryEmbedding).limit(limit).toArray();
        return results.map((r: any, idx: number) => ({
            id: r.id || `doc_${idx}`,
            text: r.text,
            source_file: r.source_file,
            category: r.category,
            subcategory: r.subcategory,
            document_name: r.document_name,
        }));
    } catch (error) {
        console.error("   âŒ Error searching legal docs:", error);
        return [];
    }
}

/**
 * Build context string from RAG results for the LLM
 * @param {any[]} sources - Array of legal document sources
 * @returns Formatted context string
 */
function buildContext(sources: any[]): string {
    if (sources.length === 0) return "";
    return sources.map((doc, i) => {
        return `[Reference ${i + 1}]: ${doc.document_name || "Legal Document"}
Category: ${doc.category || "General"}${doc.subcategory ? ` > ${doc.subcategory}` : ""}
---
${doc.text}
---`;
    }).join("\n\n");
}

/**
 * Generate a single blog article in a specific language.
 * 
 * WHY the prompt is so specific: each article targets exact SEO keyword phrases
 * that need to appear naturally in the content for Google ranking.
 * 
 * @param {BlogTopic} topic - The SEO topic config
 * @param {typeof LANGUAGES[0]} language - Target language
 * @param {string} context - RAG context from legal docs
 * @returns Generated blog object
 */
async function generateBlogInLanguage(
    topic: BlogTopic,
    language: typeof LANGUAGES[0],
    context: string,
): Promise<GeneratedBlog> {
    console.log(`      ğŸŒ [${language.name}] Generating...`);

    const languageInstructions: Record<string, string> = {
        ar: `Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰. Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø³Ù„ÙˆØ¨Ù‹Ø§ ÙˆØ§Ø¶Ø­Ù‹Ø§ ÙˆÙ…ÙÙ‡ÙˆÙ…Ù‹Ø§ Ù„Ù„Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¹Ø§Ø¯ÙŠ.
Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ© (emojis) Ø£Ø¨Ø¯Ù‹Ø§.
Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©.`,
        en: `Write the article in clear, professional English accessible to non-lawyers.
Never use emojis.
Use proper British/American English grammar and punctuation.`,
        fr: `RÃ©digez l'article en franÃ§ais clair et professionnel, accessible aux non-juristes.
N'utilisez jamais d'emojis.
Utilisez une grammaire et une ponctuation franÃ§aises correctes.`,
    };

    // SEO-optimized system prompt â€” ensures keywords appear naturally in the content
    const systemPrompt = `You are an expert legal content writer specializing in Moroccan law and SEO.
Your task is to write a professional, educational blog article OPTIMIZED FOR GOOGLE SEARCH.

${languageInstructions[language.code]}

SEO & WRITING GUIDELINES:
1. Write in clear, accessible language that non-lawyers can understand
2. NATURALLY incorporate these target keywords throughout the article: ${topic.keywords.join(", ")}
3. Structure with clear H2 (##) and H3 (###) headings â€” use keyword-rich headings
4. Include specific references to Moroccan laws, codes, and articles when available
5. Include practical examples and real-world applications
6. Mention 9anon AI as a free tool for getting legal help on this topic
7. Target length: 1000-1500 words (detailed blog post)
8. Use proper markdown formatting throughout
9. NEVER use emojis
10. Include internal linking suggestion at the end: mention 9anon AI chatbot

ARTICLE STRUCTURE:
- SEO-optimized introduction (2-3 paragraphs, include primary keyword in first paragraph)
- 4-5 main sections with practical, keyword-rich information
- A section about how 9anon AI can help with this legal topic
- Conclusion with key takeaways

At the end, add this exact section:
---

### Related Search Terms
9anoun ai, 9anon ai, kanon ai, kanoun ai, qanon ai, qanoun ai`;

    const userPrompt = context
        ? `Based on the following legal references from Moroccan law:

${context}

---

Write a blog article with title: "${topic.titles[language.code as keyof typeof topic.titles]}"

SEO Keywords to naturally include: ${topic.keywords.join(", ")}

Generate a comprehensive, SEO-optimized blog article that educates readers and ranks on Google.`
        : `Write a blog article with title: "${topic.titles[language.code as keyof typeof topic.titles]}"

SEO Keywords to naturally include: ${topic.keywords.join(", ")}

Generate a comprehensive, SEO-optimized blog article that educates readers and ranks on Google.
Use your knowledge of Moroccan legal frameworks and cite specific laws where applicable.`;

    const response = await client.chat.completions.create({
        model: "google/gemini-3-flash-preview",
        messages: [
            { role: "system", content: systemPrompt },
            { role: "user", content: userPrompt },
        ],
        max_tokens: 4000,
        temperature: 0.7,
    });

    const content = response.choices[0]?.message?.content || "";
    console.log(`      âœ… [${language.name}] Done (${content.length} chars)`);

    return {
        slug: topic.slug,
        language: language.code,
        title: topic.titles[language.code as keyof typeof topic.titles],
        description: topic.descriptions[language.code as keyof typeof topic.descriptions],
        content: content,
        sources: [],
        generatedAt: new Date(),
    };
}

/**
 * Save a blog article to the filesystem as a Markdown file with frontmatter
 * @param {GeneratedBlog} blog - The generated blog
 * @param {typeof LANGUAGES[0]} language - Language config
 * @param {string} outputDir - Output directory
 */
function saveBlog(blog: GeneratedBlog, language: typeof LANGUAGES[0], outputDir: string): void {
    const filename = `${blog.slug}${language.suffix}.md`;
    const filepath = path.join(outputDir, filename);

    const frontmatter = `---
title: "${blog.title}"
date: "${blog.generatedAt.toISOString().split("T")[0]}"
description: "${blog.description}"
---

`;
    const fullContent = frontmatter + blog.content;
    fs.writeFileSync(filepath, fullContent, "utf-8");
    console.log(`      ğŸ’¾ Saved: ${filename}`);
}

/**
 * Main execution â€” generates all SEO-targeted articles
 */
async function main(): Promise<void> {
    console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘     ğŸ‡²ğŸ‡¦ SEO-TARGETED BLOG GENERATOR                          â•‘");
    console.log(`â•‘     Generating ${SEO_TOPICS.length} articles Ã— 3 languages = ${SEO_TOPICS.length * 3} blog posts      â•‘`);
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

    if (!process.env.OPENROUTER_API_KEY) {
        console.error("âŒ ERROR: OPENROUTER_API_KEY environment variable is not set.");
        process.exit(1);
    }

    // Output to the FE blogs directory
    const outputDir = path.resolve(__dirname, "..", "..", "FE", "content", "blogs");

    if (!fs.existsSync(outputDir)) {
        console.error("âŒ ERROR: Blogs directory not found:", outputDir);
        process.exit(1);
    }

    // Check which articles already exist to skip them
    const existingFiles = fs.readdirSync(outputDir);
    const existingSlugs = new Set(
        existingFiles.map(f => f.replace(/\.(en|fr)\.md$/, "").replace(/\.md$/, ""))
    );

    // Filter out already-generated topics
    const topicsToGenerate = SEO_TOPICS.filter(t => !existingSlugs.has(t.slug));

    if (topicsToGenerate.length === 0) {
        console.log("âœ… All SEO articles already exist! Nothing to generate.");
        return;
    }

    console.log(`ğŸ“ Output directory: ${outputDir}`);
    console.log(`ğŸ“ ${topicsToGenerate.length} new topics to generate (${SEO_TOPICS.length - topicsToGenerate.length} already exist)\n`);

    const startTime = Date.now();
    let successCount = 0;
    let failCount = 0;

    for (let topicIdx = 0; topicIdx < topicsToGenerate.length; topicIdx++) {
        const topic = topicsToGenerate[topicIdx];
        console.log(`\nğŸ“ [${topicIdx + 1}/${topicsToGenerate.length}] Topic: "${topic.titles.en}"`);

        // Search RAG for legal context
        console.log(`   ğŸ” Searching legal database...`);
        const sources = await searchLegalDocs(topic.searchQuery, 8);
        console.log(`   âœ… Found ${sources.length} relevant legal references`);

        const context = buildContext(sources);

        // Generate in all 3 languages
        for (let langIdx = 0; langIdx < LANGUAGES.length; langIdx++) {
            const language = LANGUAGES[langIdx];
            try {
                const blog = await generateBlogInLanguage(topic, language, context);
                blog.sources = sources.map(s => s.document_name || s.source_file || "Unknown");
                saveBlog(blog, language, outputDir);
                successCount++;

                // Small delay between API calls to avoid rate limiting
                await new Promise(resolve => setTimeout(resolve, 1500));
            } catch (error) {
                console.error(`      âŒ [${language.name}] Failed:`, error);
                failCount++;
            }
        }

        // Delay between topics
        if (topicIdx < topicsToGenerate.length - 1) {
            console.log(`   â³ Waiting 3 seconds before next topic...`);
            await new Promise(resolve => setTimeout(resolve, 3000));
        }
    }

    const duration = ((Date.now() - startTime) / 1000 / 60).toFixed(1);

    console.log("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘                    GENERATION COMPLETE                        â•‘");
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    console.log(`\nâœ… Successfully generated: ${successCount} blog posts`);
    if (failCount > 0) console.log(`âŒ Failed: ${failCount} blog posts`);
    console.log(`â±ï¸  Total time: ${duration} minutes`);
    console.log(`ğŸ“ Blogs saved to: ${outputDir}`);
}

main().catch(console.error);
